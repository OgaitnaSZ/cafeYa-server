generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model calificacion {
  id                 String   @id @default(dbgenerated("(uuid())")) @db.Char(36)
  pedido_id          String   @db.Char(36)
  puntuacion         Int
  resena             String?  @db.Text
  fecha              DateTime @default(now()) @db.Timestamp(0)
  nombre_del_cliente String   @db.VarChar(255)
  pedido             pedido   @relation(fields: [pedido_id], references: [id], onUpdate: Restrict, map: "calificacion_ibfk_1")

  @@index([pedido_id], map: "idx_calificacion_pedido")
}

model cliente {
  id         Int      @id @default(autoincrement())
  nombre     String   @db.VarChar(255)
  created_at DateTime @default(now()) @db.Timestamp(0)
  telefono   String?  @db.VarChar(20)
  email      String?  @db.VarChar(255)
}

model mesa {
  numero                   Int         @id
  estado                   mesa_estado @default(Disponible)
  codigo_qr                String      @unique(map: "codigo_qr") @db.VarChar(255)
  codigo_dinamico          String      @db.VarChar(255)
  created_at               DateTime    @default(now()) @db.Timestamp(0)
  updated_at               DateTime    @default(now()) @db.Timestamp(0)
  pedido_pedido_mesaTomesa pedido[]    @relation("pedido_mesaTomesa")
}

model pago {
  id            String             @id @default(dbgenerated("(uuid())")) @db.Char(36)
  pedido_id     String             @db.Char(36)
  medio_de_pago pago_medio_de_pago
  monto         Decimal            @db.Decimal(10, 2)
  IVA           Decimal            @db.Decimal(10, 2)
  monto_final   Decimal            @db.Decimal(10, 2)
  fecha         DateTime           @default(now()) @db.Timestamp(0)
  pedido        pedido             @relation(fields: [pedido_id], references: [id], onUpdate: Restrict, map: "pago_ibfk_1")

  @@index([pedido_id], map: "idx_pago_pedido")
}

model pedido {
  id                     String            @id @default(dbgenerated("(uuid())")) @db.Char(36)
  cliente                String            @db.VarChar(255)
  mesa                   Int
  nota                   String?           @db.Text
  precio_total           Decimal           @db.Decimal(10, 2)
  estado                 pedido_estado     @default(Pendiente)
  fecha                  DateTime          @default(now()) @db.Timestamp(0)
  pedido_padre           String?           @db.Char(36)
  calificacion           calificacion[]
  pago                   pago[]
  mesa_pedido_mesaTomesa mesa              @relation("pedido_mesaTomesa", fields: [mesa], references: [numero], onUpdate: Restrict, map: "pedido_ibfk_1")
  pedido                 pedido?           @relation("pedidoTopedido", fields: [pedido_padre], references: [id], onUpdate: Restrict, map: "pedido_ibfk_2")
  other_pedido           pedido[]          @relation("pedidoTopedido")
  pedido_producto        pedido_producto[]

  @@index([estado], map: "idx_pedido_estado")
  @@index([fecha], map: "idx_pedido_fecha")
  @@index([mesa], map: "idx_pedido_mesa")
  @@index([pedido_padre], map: "idx_pedido_padre")
}

model pedido_producto {
  id              Int      @id @default(autoincrement())
  pedido_id       String   @db.Char(36)
  producto_id     String   @db.Char(36)
  cantidad        Int      @default(1)
  precio_unitario Decimal  @db.Decimal(10, 2)
  pedido          pedido   @relation(fields: [pedido_id], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "pedido_producto_ibfk_1")
  producto        producto @relation(fields: [producto_id], references: [id], onUpdate: Restrict, map: "pedido_producto_ibfk_2")

  @@index([pedido_id], map: "pedido_id")
  @@index([producto_id], map: "producto_id")
}

model producto {
  id              String            @id @default(dbgenerated("(uuid())")) @db.Char(36)
  nombre          String            @db.VarChar(255)
  descripcion     String            @db.Text
  imagen_url      String?           @db.VarChar(500)
  categoria       String            @db.VarChar(100)
  precio          Decimal           @db.Decimal(10, 2)
  disponibilidad  Boolean           @default(true)
  created_at      DateTime          @default(now()) @db.Timestamp(0)
  updated_at      DateTime          @default(now()) @db.Timestamp(0)
  pedido_producto pedido_producto[]

  @@index([categoria], map: "idx_producto_categoria")
  @@index([disponibilidad], map: "idx_producto_disponibilidad")
}

model usuario {
  id         Int         @id @default(autoincrement())
  nombre     String      @db.VarChar(255)
  email      String      @unique(map: "email") @db.VarChar(255)
  password   String      @db.VarChar(255)
  rol        usuario_rol
  activo     Boolean?    @default(true)
  created_at DateTime    @default(now()) @db.Timestamp(0)
  updated_at DateTime    @default(now()) @db.Timestamp(0)
}

enum mesa_estado {
  Disponible
  Ocupada
}

enum pago_medio_de_pago {
  app
  tarjeta
  efectivo
}

enum pedido_estado {
  Pendiente
  En_preparaci_n @map("En preparaci√≥n")
  Entregado
}

enum usuario_rol {
  encargado
  cocina
  admin
}
